<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Math Shooter</title>
<style>
    body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; background: #111; color: white;}
    canvas { display: block; margin: 0 auto; background: #222; }
    #score { position: absolute; top: 10px; left: 10px; font-size: 20px; }
    #question { position: absolute; top: 10px; width: 100%; text-align: center; font-size: 32px; font-weight: bold; }
</style>
</head>
<body>
<div id="score">Score: 0</div>
<div id="question"></div>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let score = 0;
let bullets = [];
let answers = [];
let currentQuestionIndex = 0;
let gameOver = false;

// Sample questions â€” replace with full 100 later
const questions = [
  {q:"Which is a prime number?", options:["4","7","9","12"], answer:"7"},
  {q:"Simplify: 3 + 5 - 2", options:["6","5","7","8"], answer:"6"},
  {q:"LCM of 4 and 6?", options:["10","12","14","24"], answer:"12"},
  {q:"What is -3 + 5?", options:["2","-2","3","1"], answer:"2"},
  {q:"3x if x = 2?", options:["6","5","4","8"], answer:"6"},
];

const player = { x: canvas.width/2, y: canvas.height - 50, width: 10, height: 10, speed: 7 };
const keys = {};

document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);
document.addEventListener('keydown', e => { if(e.key === ' ') shoot(); });

function shoot() {
    bullets.push({x: player.x, y: player.y, width: 4, height: 10});
}

function generateAnswers() {
    answers = [];
    const opts = questions[currentQuestionIndex].options;
    for(let i=0;i<opts.length;i++){
        answers.push({
            x: 200 + i*150,
            y: -100,
            z: 300 + i*50, // pseudo-3D depth
            width: 100,
            height: 50,
            text: opts[i],
            speed: 1.2 + Math.random()*0.5 // slower than before
        });
    }
    document.getElementById('question').innerText = questions[currentQuestionIndex].q;
}

function update() {
    if(gameOver) return;

    // Move player
    if(keys['a'] && player.x > 0) player.x -= player.speed;
    if(keys['d'] && player.x < canvas.width) player.x += player.speed;
    if(keys['w'] && player.y > canvas.height/2) player.y -= player.speed;
    if(keys['s'] && player.y < canvas.height-30) player.y += player.speed;

    // Move bullets
    bullets.forEach((b,i)=>{
        b.y -= 6; // slower bullets
        answers.forEach((a,j)=>{
            const scale = 300/a.z; 
            const ax = a.x + (a.width*(1-scale)/2);
            const ay = a.y + (a.height*(1-scale)/2);
            const aw = a.width * scale;
            const ah = a.height * scale;

            if(b.x < ax+aw && b.x+b.width>ax &&
               b.y < ay+ah && b.y+b.height>ay){
                if(a.text === questions[currentQuestionIndex].answer){
                    score++;
                    nextQuestion();
                } else {
                    score = Math.max(0, score-1);
                }
                bullets.splice(i,1);
            }
        });
    });

    // Move answers toward player
    answers.forEach((a,i)=>{
        a.z -= a.speed;
        if(a.z <= 50){
            if(a.text === questions[currentQuestionIndex].answer){
                gameOver = true;
                alert("You missed the correct answer! Game Over! Score: " + score);
            } else {
                answers.splice(i,1);
            }
        }
    });
}

function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Draw player
    ctx.fillStyle = "white";
    ctx.fillRect(player.x, player.y, player.width, player.height);

    // Draw bullets
    bullets.forEach(b=>{
        ctx.fillStyle = "yellow";
        ctx.fillRect(b.x, b.y, b.width, b.height);
    });

    // Draw answers with pseudo-3D
    answers.forEach(a=>{
        const scale = Math.min(300 / a.z,1);
        const aw = a.width * scale;
        const ah = a.height * scale;
        const ax = a.x + (a.width*(1-scale)/2);
        const ay = a.y + (a.height*(1-scale)/2);

        ctx.fillStyle = "red";
        ctx.fillRect(ax, ay, aw, ah);
        ctx.fillStyle = "white";
        ctx.font = `${20*scale + 12}px Arial`;
        ctx.fillText(a.text, ax + 10*scale, ay + 30*scale);
    });

    document.getElementById('score').innerText = "Score: " + score;
}

function nextQuestion() {
    currentQuestionIndex = (currentQuestionIndex+1)%questions.length;
    generateAnswers();
    bullets = [];
}

function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

generateAnswers();
gameLoop();
</script>
</body>
</html>
